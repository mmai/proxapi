<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Tutorial: tutorial</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Tutorial: tutorial</h1>

    <section>

<header>
    

    <h2>tutorial</h2>
</header>

<article>
    <h1>Proxapi tutorial</h1><p>Let's look at a call to the Google geocoding service. Here is a code example, without Proxapi, which displays an address coordinates if everything is ok, and an error message if usage limitations have been reached. </p>
<pre class="prettyprint source lang-javascript"><code>var geocoder = new google.maps.Geocoder();
geocoder.geocode({ 'address': 'Bordeaux, France' }, function(results, status) {
  if (status == google.maps.GeocoderStatus.OK) {
    console.log(results[0].geometry.location);
  } else if (status == google.maps.GeocoderStatus.OVER_QUERY_LIMIT) {
    console.log(&quot;Error : usage limitations reached&quot;);
  }
});</code></pre><p>We are going to use Proxapi in order to call the API every minute if we are notified that the usage limit has been reached. Here is how we initialize and call Proxapi, the <em>translate</em> function content is explained next.</p>
<pre class="prettyprint source lang-javascript"><code>var geocoder_proxy = new Proxapi({
  strategy: 'retry',
  retry_delay: 60, // Retrying every minute
  translate: function(params, proxy_callback){
        //...
        }
};

geocoder_proxy.call({address: 'Bordeaux, France'}, function(err, results){
  if (err) {
    console.log(err);
  } else {
    console.log(results[0].geometry.location);
  }
});</code></pre><p>The <em>translate</em> function used in the initialization allows Proxapi to call the API and to understand the results. It follows this scenario : </p>
<ul>
<li>call the API with the <em>params</em> parameters which are the same as those given to the <em>Proxapi.call</em> function (in our example : <code>{adress: 'Bordeaux, France'}</code>)</li>
<li>get the results</li>
<li>catch errors and detect quota limits</li>
<li>return to Proxapi by calling <em>proxy_callback</em> with the following arguments:<ul>
<li><em>err</em> : errors not associated to usage limitations</li>
<li><em>results</em> : API request results</li>
<li><em>proxapi_status</em> : information about the request, you must set at least <em>proxapi_status.quota</em> boolean value ( <em>true</em> if the request failed due to usage limitations, <em>false</em> if there wasn't any quota error).</li>
</ul>
</li>
</ul>
<p>Here is the complete code. When using other APIs, you only need to modify the sections marked &quot;XXX needs modifications&quot; in the <em>translate</em> function : </p>
<pre class="prettyprint source lang-javascript"><code>var geocoder_proxy = new Proxapi({
  strategy: 'retry',
  retry_delay: 60, //Retrying every minute
  translate: function(params, proxy_callback){ 
    // XXX following line needs modifications (API call)
    geocoder.geocode({ 'address': params.address }, function(results, status) {
      var proxapi_status = { quota: false };
      var err = null;

      // Transformation from the API response format to the proxy_callback format
      // XXX following block needs modifications
      if (status == google.maps.GeocoderStatus.OVER_QUERY_LIMIT) {
        proxapi_status.quota = true;
      } else if (status !== google.maps.GeocoderStatus.OK) { 
          err = status;
      }

      //Finally return to Proxapi
      proxy_callback(err, results, proxapi_status); 
    });
  }
});

geocoder_proxy.call({address: 'Bordeaux, France'}, function(err, results){
  if (err) {
    console.log(err);
  } else {
    console.log(results[0].geometry.location);
  }
});</code></pre><p>Look in the <em>examples/</em> directory for more complete concrete examples.</p>
</article>

</section>

</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="ProxAPI.html">ProxAPI</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-tutorial.html">tutorial</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha9</a> on Sat Sep 13 2014 18:59:14 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>